<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Results · SimpleSearch + AI</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#111}
    header{display:flex;gap:16px;align-items:center;padding:12px 16px;border-bottom:1px solid #eee;position:sticky;top:0;background:#fff}
    .brand{font-weight:700;font-size:20px}
    form{flex:1;display:flex;gap:10px;align-items:center;max-width:700px}
    input{flex:1;padding:10px 12px;border:1px solid #e0e0e0;border-radius:999px;outline:none}
    button{padding:9px 14px;border:1px solid #e0e0e0;border-radius:8px;background:white;cursor:pointer}
    .container{max-width:800px;margin:18px auto;padding:0 16px}
    .ans{white-space:pre-wrap;line-height:1.6}
    .meta{color:#666;font-size:14px;margin-top:6px}
    .error{color:#b00020;white-space:pre-wrap}
  </style>
</head>
<body>
  <header>
    <div class="brand">Simple<span style="color:#1a73e8">Search</span> + AI</div>
    <form action="results.html">
      <input name="q" id="q" placeholder="Ask anything..." />
      <button type="submit">Search</button>
    </form>
  </header>

  <main class="container">
    <div id="meta" class="meta"></div>
    <div id="answer" class="ans"></div>
    <div id="error" class="error"></div>
  </main>

  <script>
    // Same-origin in prod; Live Server (5500) -> call localhost:8080
    const API_BASE = (location.hostname === 'localhost' && location.port === '5500') ? 'http://localhost:8080' : '';
    const params = new URLSearchParams(location.search);
    const q = params.get('q') || '';
    document.getElementById('q').value = q;

    async function run() {
      document.getElementById('meta').textContent = 'Query: ' + q;
      document.getElementById('answer').textContent = 'Loading...';
      document.getElementById('error').textContent = '';

      try {
        const r = await fetch(`${API_BASE}/api/chat?q=` + encodeURIComponent(q));
        const body = await r.json();
        if (!r.ok) throw new Error(body.error || ('HTTP ' + r.status));
        const openai = typeof body.openai === 'string' ? JSON.parse(body.openai) : body.openai;
        const choice = openai.choices && openai.choices[0];
        const text = choice && choice.message && choice.message.content ? choice.message.content : JSON.stringify(openai, null, 2);
        document.getElementById('answer').textContent = text;
        document.getElementById('meta').textContent = 'Model: ' + (body.model || 'unknown') + ' · Query: ' + q;
      } catch (e) {
        document.getElementById('answer').textContent = '';
        document.getElementById('error').textContent = 'Error: ' + e.message + '\nTip: Is the Java server running on port 8080?';
      }
    }
    run();
  </script>
</body>
</html>
